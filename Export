import streamlit as st
import pandas as pd
import io

df = pd.read_csv("data/processed/players_combined.csv")

st.header("Export Data Scores by League and Position")

leagues = df['League'].dropna().unique()
positions = df['Position'].dropna().unique()

selected_league = st.selectbox("Select League", sorted(leagues))
selected_position = st.selectbox("Select Position", sorted(positions))

filtered_df = df[
    (df['League'] == selected_league) & 
    (df['Position'] == selected_position)
][['Player Name', 'data_score', 'weighted_l1_score']]

if not filtered_df.empty:
    st.write(f"Players in {selected_league} - {selected_position}:")
    st.dataframe(filtered_df)

    output = io.BytesIO()
    with pd.ExcelWriter(output, engine='xlsxwriter') as writer:
        filtered_df.to_excel(writer, index=False, sheet_name=f"{selected_league}_{selected_position}")
        writer.save()
    output.seek(0)

    st.download_button(
        label="Download Excel file",
        data=output,
        file_name=f"{selected_league}_{selected_position}_players.xlsx",
        mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
    )
else:
    st.warning("No data for this league/position.")
